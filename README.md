# üöÄ Dockerized Multi-Project Deployment Environment with Caddy Proxy

‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏≠‡∏õ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏î‡πâ‡∏ß‡∏¢ Docker Compose + Caddy Proxy  
‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¥‡∏™‡∏£‡∏∞ ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏î‡πÄ‡∏°‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏î‡πâ‡∏ß‡∏¢ label-based routing

---

## üì¶ Stack ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö

- ‚úÖ **Frontend / Backoffice**: Vue.js (‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡∏ú‡πà‡∏≤‡∏ô Nginx)
- ‚úÖ **API**: NestJS (‡∏´‡∏£‡∏∑‡∏≠ NodeJS backend ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ)
- ‚úÖ **Database**: PostgreSQL
- ‚úÖ **Proxy & SSL**: Caddy Docker Proxy (auto HTTPS ‡∏î‡πâ‡∏ß‡∏¢ Let's Encrypt)

---

## üìÅ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå

```plaintext
multi-project-deployment-infra/
‚îú‚îÄ‚îÄ _project-template/            # ‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml
‚îÇ   ‚îú‚îÄ‚îÄ frontend/ (Vue.js + Nginx)
‚îÇ   ‚îú‚îÄ‚îÄ backoffice/ (Vue.js + Nginx)
‚îÇ   ‚îî‚îÄ‚îÄ api/ (NestJS)
‚îÇ
‚îú‚îÄ‚îÄ projects/                     # ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡πá‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏à‡∏£‡∏¥‡∏á
‚îÇ   ‚îî‚îÄ‚îÄ my-project/              # ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå (‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏à‡∏≤‡∏Å template)
‚îÇ       ‚îî‚îÄ‚îÄ docker-compose.yml
‚îÇ
‚îú‚îÄ‚îÄ reverse-proxy/               # Caddy Docker Proxy ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö routing
‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.yml
‚îÇ
‚îú‚îÄ‚îÄ server-setup.sh              # ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Docker + Compose ‡∏ö‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
‚îú‚îÄ‚îÄ docker-start.sh              # ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
‚îú‚îÄ‚îÄ docker-stop.sh               # ‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
‚îú‚îÄ‚îÄ docker-restart.sh            # ‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
‚îî‚îÄ‚îÄ README.md                    # ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÅ‡∏´‡∏•‡∏∞‡∏à‡πâ‡∏≤
```

---

## üõ† ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå (‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)

```bash
./server-setup.sh
```

‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà script ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ:
- ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Docker + Compose
- ‡∏™‡∏£‡πâ‡∏≤‡∏á docker network ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö proxy
- ‡πÄ‡∏õ‡∏¥‡∏î Firewall (UFW)
- ‡πÄ‡∏û‡∏¥‡πà‡∏° user ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏° docker
- ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ reboot ‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á

---

## üöÄ ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö

1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å template:

```bash
cp -r _project-template projects/my-project
```

2. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `.env` ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô `projects/my-project/` ‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå, ‡∏û‡∏≠‡∏£‡πå‡∏ï, ‡πÇ‡∏î‡πÄ‡∏°‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢

3. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:

```bash
./docker-start.sh
```

> ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏±‡πà‡∏á‡∏£‡∏±‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå:
```bash
./docker-start.sh --only=my-project
```

---

## üåê ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Caddy Proxy

Caddy ‡∏à‡∏∞ map ‡πÇ‡∏î‡πÄ‡∏°‡∏ô‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏à‡∏≤‡∏Å label ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ô `docker-compose.yml`  
‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á HTTP ‚Üí HTTPS, reverse proxy ‡πÅ‡∏•‡∏∞ wildcard domain

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á label:
```yaml
labels:
  caddy: api.myproject.com
  caddy.reverse_proxy: "{{upstreams 3000}}"
  caddy.redirects: "http://{http.request.hostport} https://{http.request.hostport}"
```

---

## üß™ Health Check

‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ `healthcheck` ‡∏Ñ‡∏£‡∏ö:
- PostgreSQL ‚Üí `pg_isready`
- API ‚Üí `curl` ‡πÄ‡∏ä‡πá‡∏Ñ‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏†‡∏≤‡∏¢‡πÉ‡∏ô
- Caddy Proxy ‚Üí `wget` localhost

---

## üìå Tips

- ‡πÉ‡∏ä‡πâ `.env` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏î‡πÄ‡∏°‡∏ô‡πÅ‡∏•‡∏∞‡∏û‡∏≠‡∏£‡πå‡∏ï‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢
- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ container ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ `${PROJECT_NAME}-xxx` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ä‡∏ô‡∏Å‡∏±‡∏ô
- ‡πÄ‡∏û‡∏¥‡πà‡∏° `volume` ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö SSL ‡∏ü‡∏£‡∏µ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏î‡πâ‡∏ß‡∏¢ Let's Encrypt

---

## üß† ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

- ‡πÉ‡∏ä‡πâ `git clone` repo ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô infra ‡∏Å‡∏•‡∏≤‡∏á ‡πÅ‡∏•‡πâ‡∏ß copy `_project-template` ‡πÑ‡∏õ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà
- ‡∏ï‡∏±‡πâ‡∏á DNS ‡πÄ‡∏õ‡πá‡∏ô `*.yourdomain.com` ‚Üí ‡∏ä‡∏µ‡πâ‡∏°‡∏≤‡∏¢‡∏±‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ
